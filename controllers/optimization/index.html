
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../observability/">
      
      
        <link rel="next" href="../manifests/">
      
      
      <link rel="icon" href="../../favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.28">
    
    
      
        <title>Optimization - kube</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#optimization" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="kube" class="md-header__button md-logo" aria-label="kube" data-md-component="logo">
      
  <img src="../../favicon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            kube
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Optimization
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="light-blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/kube-rs/kube" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    kube
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../getting-started/" class="md-tabs__link">
          
  
  Information

        </a>
      </li>
    
  

    
  

      
        
  
  
    
  
  
    
    
      
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../intro/" class="md-tabs__link">
          
  
  Controllers

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../crates/kube/" class="md-tabs__link">
          
  
  Crates

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../governance/" class="md-tabs__link">
          
  
  Contributing

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../blog/" class="md-tabs__link">
          
  
  Blog

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="kube" class="md-nav__button md-logo" aria-label="kube" data-md-component="logo">
      
  <img src="../../favicon.png" alt="logo">

    </a>
    kube
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/kube-rs/kube" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    kube
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    
  
  
    <a href="../../getting-started/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Information
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Controllers
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Controllers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Concepts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../object/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The Object
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reconciler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The Reconciler
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../application/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The Application
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../relations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Related Objects
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Garbage Collection
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../schemas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Schemas
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Advanced
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Advanced
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../testing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Testing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../admission/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Admission
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../streams/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Streams
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../generics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Generics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../internals/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Internals
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" checked>
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Operational
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Operational
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../observability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Observability
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Optimization
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Optimization
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#watcher-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Watcher Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Watcher Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reducing-number-of-watched-objects" class="md-nav__link">
    <span class="md-ellipsis">
      Reducing Number of Watched Objects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backoff-on-errors" class="md-nav__link">
    <span class="md-ellipsis">
      Backoff on Errors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#watching-metadata-only" class="md-nav__link">
    <span class="md-ellipsis">
      Watching Metadata Only
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Watching Metadata Only">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-changing-associated-streams" class="md-nav__link">
    <span class="md-ellipsis">
      1. Changing Associated Streams
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-changing-primary-streams" class="md-nav__link">
    <span class="md-ellipsis">
      2. Changing Primary Streams
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-changing-predicated-primary-streams" class="md-nav__link">
    <span class="md-ellipsis">
      3. Changing Predicated Primary Streams
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoiding-the-list-spike" class="md-nav__link">
    <span class="md-ellipsis">
      Avoiding the List Spike
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#page-size" class="md-nav__link">
    <span class="md-ellipsis">
      Page Size
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#streaming-lists" class="md-nav__link">
    <span class="md-ellipsis">
      Streaming Lists
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reflector-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Reflector Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reflector Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pruning-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Pruning Fields
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reconciler-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Reconciler Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reconciler Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#repeatedly-triggering-yourself" class="md-nav__link">
    <span class="md-ellipsis">
      Repeatedly Triggering Yourself
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debouncing-repetitions" class="md-nav__link">
    <span class="md-ellipsis">
      Debouncing Repetitions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reconciler-concurrency" class="md-nav__link">
    <span class="md-ellipsis">
      Reconciler Concurrency
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-optimizations" class="md-nav__link">
    <span class="md-ellipsis">
      Future Optimizations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../manifests/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Manifests
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../scaling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scaling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../availability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Availability
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../crates/kube/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Crates
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../governance/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../blog/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Blog
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#watcher-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Watcher Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Watcher Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reducing-number-of-watched-objects" class="md-nav__link">
    <span class="md-ellipsis">
      Reducing Number of Watched Objects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backoff-on-errors" class="md-nav__link">
    <span class="md-ellipsis">
      Backoff on Errors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#watching-metadata-only" class="md-nav__link">
    <span class="md-ellipsis">
      Watching Metadata Only
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Watching Metadata Only">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-changing-associated-streams" class="md-nav__link">
    <span class="md-ellipsis">
      1. Changing Associated Streams
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-changing-primary-streams" class="md-nav__link">
    <span class="md-ellipsis">
      2. Changing Primary Streams
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-changing-predicated-primary-streams" class="md-nav__link">
    <span class="md-ellipsis">
      3. Changing Predicated Primary Streams
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoiding-the-list-spike" class="md-nav__link">
    <span class="md-ellipsis">
      Avoiding the List Spike
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#page-size" class="md-nav__link">
    <span class="md-ellipsis">
      Page Size
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#streaming-lists" class="md-nav__link">
    <span class="md-ellipsis">
      Streaming Lists
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reflector-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Reflector Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reflector Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pruning-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Pruning Fields
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reconciler-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Reconciler Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reconciler Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#repeatedly-triggering-yourself" class="md-nav__link">
    <span class="md-ellipsis">
      Repeatedly Triggering Yourself
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debouncing-repetitions" class="md-nav__link">
    <span class="md-ellipsis">
      Debouncing Repetitions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reconciler-concurrency" class="md-nav__link">
    <span class="md-ellipsis">
      Reconciler Concurrency
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-optimizations" class="md-nav__link">
    <span class="md-ellipsis">
      Future Optimizations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/kube-rs/website/edit/main/docs/controllers/optimization.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  


<h1 id="optimization">Optimization<a class="headerlink" href="#optimization" title="Permanent link">#</a></h1>
<p>This document aims to help optimize various factors of resource consumption by controllers, and it will effectively be a guide on how to reduce the usage of your <a href="https://docs.rs/kube/latest/kube/runtime/fn.watcher.html">watcher</a> streams to simplify things for downstream consumers.</p>
<h2 id="watcher-optimization">Watcher Optimization<a class="headerlink" href="#watcher-optimization" title="Permanent link">#</a></h2>
<p>One of the biggest contributor to activity in a <a href="https://docs.rs/kube/latest/kube/runtime/struct.Controller.html">Controller</a> is the constant, long-polling watch of the min <a href="../object/">object</a> and every related object by the use of multiple <a href="https://docs.rs/kube/latest/kube/runtime/fn.watcher.html">watcher</a> streams created with some variant of:</p>
<div class="highlight"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">cfg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">watcher</span><span class="p">::</span><span class="n">Config</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">RESTRICTIONS</span><span class="w"> </span><span class="p">};</span>
<span class="kd">let</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SOME_WATCHER</span><span class="p">(</span><span class="n">cfg</span><span class="p">).</span><span class="n">SOME_MODIFICATION</span><span class="p">();</span>
</code></pre></div>
<p>By <strong>default</strong>, <a href="https://docs.rs/kube/latest/kube/runtime/fn.watcher.html">watcher</a> streams are <strong>implicitly configured</strong> within the <a href="https://docs.rs/kube/latest/kube/runtime/struct.Controller.html">Controller</a>, but using the controller streams interface outlined in the <strong><a href="../streams/">streams</a> chapter</strong>, you can customize every aspect of these streams.</p>
<p>The central premise herein is that <strong>controllers benefit from customizing the input streams</strong> and we will show how to do these configurations.</p>
<div class="admonition warning">
<p class="admonition-title">Streams Interface Required</p>
<p>The watcher optimizations here that directly call <code>watcher</code> / <code>metadata_watcher</code> require the unstable <a href="../streams/">streams</a> interface to interface with controllers.</p>
</div>
<p>Better watcher configuration primarily aim to reduce IO or networked traffic. However, when used in combination with <a href="https://docs.rs/kube/latest/kube/runtime/fn.reflector.html">reflector</a> caches, they also become memory optimizations.</p>
<h3 id="reducing-number-of-watched-objects">Reducing Number of Watched Objects<a class="headerlink" href="#reducing-number-of-watched-objects" title="Permanent link">#</a></h3>
<p>The default <code>watcher::Config</code> will watch every object in the <a href="https://docs.rs/kube/latest/kube/struct.Api.html">Api</a> scope you configured:</p>
<ul>
<li><code>Api::namespaced</code> or <code>Api::default_namespaced</code> -&gt; all objects in that namespace</li>
<li><code>Api::all</code> -&gt; all cluster scoped objects (or all objects in all namespaces)</li>
</ul>
<p>This is easiest to do with <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/#api">label selectors</a> of <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/field-selectors/">field selectors</a>.</p>
<p>Field selectors <strong>can</strong> be used to filter on certain common properties:</p>
<div class="highlight"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">cfg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">watcher</span><span class="p">::</span><span class="n">Config</span><span class="p">::</span><span class="n">default</span><span class="p">().</span><span class="n">fields</span><span class="p">(</span><span class="o">&amp;</span><span class="fm">format!</span><span class="p">(</span><span class="s">&quot;metadata.name={name}&quot;</span><span class="p">));</span>
</code></pre></div>
<p>And allows explicitly <strong>excluding</strong> lists of namespaces:</p>
<div class="highlight"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">ignoring_system_namespaces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s">&quot;cert-manager&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;flux2&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;linkerd&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;linkerd-jaeger&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;linkerd-smi&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;linkerd-viz&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;gatekeeper-system&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;kube-node-lease&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;kube-public&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;kube-system&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="p">.</span><span class="n">into_iter</span><span class="p">()</span>
<span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">ns</span><span class="o">|</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">&quot;metadata.namespace!={ns}&quot;</span><span class="p">))</span>
<span class="p">.</span><span class="n">collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">()</span>
<span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">);</span>
<span class="kd">let</span><span class="w"> </span><span class="n">cfg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">watcher</span><span class="p">::</span><span class="n">Config</span><span class="p">::</span><span class="n">default</span><span class="p">().</span><span class="n">fields</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ignoring_system_namespaces</span><span class="p">);</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Field Selector Limitations</p>
<p>Due to <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/field-selectors/">field-selector</a> limitations, you cannot filter on arbitrary fields, nor can you do set operations, forcing explicit negative enumeration as one of the few helpful tricks.</p>
</div>
<p>A more general solution involves <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/">explicitly labelling</a> the objects you care about, and using the much more expressive <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/#api">label selectors</a> instead:</p>
<div class="highlight"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">cfg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Config</span><span class="p">::</span><span class="n">default</span><span class="p">().</span><span class="n">labels</span><span class="p">(</span><span class="s">&quot;environment in (production, qa)&quot;</span><span class="p">);</span>
</code></pre></div>
<h3 id="backoff-on-errors">Backoff on Errors<a class="headerlink" href="#backoff-on-errors" title="Permanent link">#</a></h3>
<p>Implicitly created controller streams are always created with a <a href="https://docs.rs/kube/latest/kube/runtime/watcher/struct.DefaultBackoff.html">DefaultBackoff</a> <code>Backoff</code> implementation (from <a href="https://crates.io/crates/backoff">backoff</a>) similar to the <a href="https://github.com/kubernetes/client-go/blob/980663e185ab6fc79163b1c2565034f6d58368db/tools/cache/reflector.go#L177-L181">defaults set by client-go</a> to avoid hammering the apiserver when errors occur.</p>
<div class="admonition warning">
<p class="admonition-title">Use backoffs</p>
<p>A watcher that does not call <code>.default_backoff()</code> or setup any other form of <code>.backoff(b)</code> will <strong>continuously loop</strong> on errors. This generally spams your logs/traces, and can starve your controller and your apiserver of resources. On newer Kubernetes versions, such behaviour can get you <a href="https://kubernetes.io/docs/concepts/cluster-administration/flow-control/#concepts">throttled</a>.</p>
</div>
<p>When going from implicit controller streams to manually created streams, remember to add <code>.default_backoff()</code> at some point in the stream chain:</p>
<div class="highlight"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">watcher</span><span class="p">(</span><span class="n">api</span><span class="p">,</span><span class="w"> </span><span class="n">cfg</span><span class="p">).</span><span class="n">default_backoff</span><span class="p">();</span>
</code></pre></div>
<h3 id="watching-metadata-only">Watching Metadata Only<a class="headerlink" href="#watching-metadata-only" title="Permanent link">#</a></h3>
<p>If you do not need all the data on the resource you are watching, then you should consider using the <a href="../streams/#metadata-watcher">streams#Metadata-Watcher</a> to reduce the amount of data being handled by your watch stream.</p>
<p>Metadata is generally responsible for a small amount of the total object size, so you can often expect a commensurate reduction in incoming bandwidth by only watching metadata. When these watches are sent through a <a href="https://docs.rs/kube/latest/kube/runtime/fn.reflector.html">reflector</a> they will also <strong>significantly reduce the reflector memory footprint</strong>:</p>
<p><img alt="" src="../memory-meta-watcher.png" /></p>
<p>Note that this memory reduction can also be achieved through <a href="#pruning-fields">#pruning-fields</a> - and you can potentially omit even more data that way by combining the approaches - but pruned data is still sent on the wire.</p>
<p>There are three pathways to consider when changing controller inputs to metadata watchers:</p>
<h4 id="1-changing-associated-streams">1. Changing Associated Streams<a class="headerlink" href="#1-changing-associated-streams" title="Permanent link">#</a></h4>
<blockquote>
<p>When watching an <strong>associated</strong> stream (via <a href="../relations/">relations</a>) that is only used for mapping and not stored.</p>
</blockquote>
<p>If you are using normal watchers for these, then there is potentially a lot of unused data go on the wire. <code>Controller::owns_stream</code> should use <code>metadata_watcher</code> in general (ownerReference lookup only needs metadata), and <code>Controller::watches_stream</code> can also do this if its lookup is based on metadata properties. See <a href="../streams/#input-streams">streams#input-streams</a>.</p>
<h4 id="2-changing-primary-streams">2. Changing Primary Streams<a class="headerlink" href="#2-changing-primary-streams" title="Permanent link">#</a></h4>
<blockquote>
<p>When only metadata properties are acted on (e.g. you have a controller that only acts on labels/annotations or similar).</p>
</blockquote>
<p>In this case you can replace the <a href="../streams/#main-stream">streams#main-stream</a> for a significant memory reduction from the mandatory reflector. Do note the caveat that this changes the type signature of your reconciler slightly.</p>
<h4 id="3-changing-predicated-primary-streams">3. Changing Predicated Primary Streams<a class="headerlink" href="#3-changing-predicated-primary-streams" title="Permanent link">#</a></h4>
<blockquote>
<p>When running a controller with predicate_filters to limit the amount of reconciler hits, and simultaneously not using the cache for anything important.</p>
</blockquote>
<p>In this case you can actually also follow the <a href="../streams/#main-stream">streams#main-stream</a> pattern and call <code>Api::get</code> on the object name when the <code>reconcile</code> function actually calls so you get an up-to-date object. Remember that if you are using <a href="https://docs.rs/kube/latest/kube/runtime/utils/predicates/index.html">predicates</a> on the long watch, then you can quickly discard many changes without requiring all of the data being transmitted.</p>
<p>Such a setup can involve running the metadata watcher with the cheaper/less consistent <a href="https://docs.rs/kube/latest/kube/runtime/watcher/struct.Config.html#method.any_semantic">any_semantic</a> because your reconciler only happens every so often, but when it does, you will do the work properly:</p>
<div class="highlight"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">deploys</span><span class="p">:</span><span class="w"> </span><span class="nc">Api</span><span class="o">&lt;</span><span class="n">Deployment</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Api</span><span class="p">::</span><span class="n">all</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>
<span class="kd">let</span><span class="w"> </span><span class="n">cfg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">watcher</span><span class="p">::</span><span class="n">Config</span><span class="p">::</span><span class="n">default</span><span class="p">().</span><span class="n">any_semantic</span><span class="p">();</span>
<span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">reader</span><span class="p">,</span><span class="w"> </span><span class="n">writer</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reflector</span><span class="p">::</span><span class="n">store</span><span class="p">();</span>
<span class="kd">let</span><span class="w"> </span><span class="n">pred_cfg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PredicateConfig</span><span class="p">::</span><span class="n">default</span><span class="p">();</span>
<span class="kd">let</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reflector</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span><span class="w"> </span><span class="n">metadata_watcher</span><span class="p">(</span><span class="n">api</span><span class="p">,</span><span class="w"> </span><span class="n">cfg</span><span class="p">))</span>
<span class="w">    </span><span class="p">.</span><span class="n">default_backoff</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="n">applied_objects</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="n">predicate_filter</span><span class="p">(</span><span class="n">predicates</span><span class="p">::</span><span class="n">generation</span><span class="p">,</span><span class="w"> </span><span class="n">pred_cfg</span><span class="p">);</span>

<span class="n">Controller</span><span class="p">::</span><span class="n">for_stream</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span><span class="w"> </span><span class="n">reader</span><span class="p">)</span><span class="o">..</span><span class="p">.</span>

<span class="k">async</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">reconcile</span><span class="p">(</span><span class="n">partial</span><span class="p">:</span><span class="w"> </span><span class="nc">Arc</span><span class="o">&lt;</span><span class="n">PartialObjectMeta</span><span class="o">&lt;</span><span class="n">Deployment</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">ctx</span><span class="p">:</span><span class="w"> </span><span class="nc">Arc</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="n">Action</span><span class="p">,</span><span class="w"> </span><span class="n">Error</span><span class="o">&gt;</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// if we are here, then we have a changed generation - fetch it fully</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">api</span><span class="p">:</span><span class="w"> </span><span class="nc">Api</span><span class="o">&lt;</span><span class="n">Deployment</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Api</span><span class="p">::</span><span class="n">namespaced</span><span class="p">(</span><span class="n">partial</span><span class="p">.</span><span class="n">namespace</span><span class="p">(),</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="n">clone</span><span class="p">());</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">deploy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">api</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="o">&amp;</span><span class="n">partial</span><span class="p">.</span><span class="n">name_any</span><span class="p">()).</span><span class="k">await</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="fm">unimplemented!</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>
<p>This will also help avoid <a href="#repeatedly-triggering-yourself">#Repeatedly Triggering Yourself</a>.</p>
<h3 id="avoiding-the-list-spike">Avoiding the List Spike<a class="headerlink" href="#avoiding-the-list-spike" title="Permanent link">#</a></h3>
<p>Because <strong>continuous watch loops</strong> (i.e. watchers) against the kube-apiserver requires an <strong>initial listing of objects</strong>, the watchers <strong>peak memory footprint</strong> is going to be dictated by how large those chunks of objects are when they arrive.</p>
<p>There are <strong>two</strong> methods to reduce this overhead (for both the apiserver and your controller), depending on what Kubernetes version you have.</p>
<h3 id="page-size">Page Size<a class="headerlink" href="#page-size" title="Permanent link">#</a></h3>
<p>On Kubernetes versions <strong>&lt;1.33</strong>, the initial <strong>listing</strong> of objects comes in the form of a <code>list</code> call, followed by a long <code>watch</code> starting at the given <code>resourceVersion</code> from the initial list.</p>
<p>On big clusters this listing is quite memory intensive (for both the apiserver and the controller), having lasting effects in form of map and vector <a href="https://doc.rust-lang.org/std/vec/struct.Vec.html#method.capacity">capacities</a> getting set to values proportional to the <a href="https://docs.rs/kube/latest/kube/runtime/watcher/struct.Config.html#structfield.page_size"><code>Config::page_size</code></a>.</p>
<p>The <strong>default list page size</strong> matches client-go's <code>500</code>, but this can be reduced further when working on large objects;</p>
<div class="highlight"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">cfg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">watcher</span><span class="p">::</span><span class="n">Config</span><span class="p">::</span><span class="n">default</span><span class="p">().</span><span class="n">page_size</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
</code></pre></div>
<h3 id="streaming-lists">Streaming Lists<a class="headerlink" href="#streaming-lists" title="Permanent link">#</a></h3>
<p>On Kubernetes &gt;=1.33, the <a href="https://kubernetes.io/blog/2025/05/09/kubernetes-v1-33-streaming-list-responses/">Kubernetes Streaming List</a> feature is generally available, and gives you all the initial objects as a stream meaning you do not have to allocate a vector per page.</p>
<p>These savings <strong>can</strong> be significant (&gt;50% reductions seen on lighter apps), but your savings may vary. When interacting with reflectors, you are storing the objects anyway, so if you were already setting page sizes low, you may not see much of an improvement.</p>
<p>This is currently <strong>not</strong> our default because it is still <a href="https://kubernetes.io/docs/reference/using-api/api-concepts/#streaming-lists">beta upstream</a>, but you can opt-in early for a bigger memory saving.</p>
<div class="highlight"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">cfg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">watcher</span><span class="p">::</span><span class="n">Config</span><span class="p">::</span><span class="n">default</span><span class="p">().</span><span class="n">streaming_lists</span><span class="p">();</span>
</code></pre></div>
<p>Note that this watch mode <strong>avoids paging entirely</strong>, and is a convenience helper to set the <a href="https://docs.rs/kube/latest/kube/runtime/watcher/struct.Config.html#structfield.initial_list_strategy">Config::initial_list_strategy</a> to <code>StreamingList</code>.</p>
<h2 id="reflector-optimization">Reflector Optimization<a class="headerlink" href="#reflector-optimization" title="Permanent link">#</a></h2>
<p>Unless you have another large in-memory cache or other similar memory users in your controller, the <strong>primary contributor</strong> to your controller's memory use is going to be the <strong>mandatory reflector</strong> for the main <a href="../object/">object</a> as well as any other <strong>optional reflectors</strong> for related objects.</p>
<p>The memory usage of reflectors is directly proportional to how much stuff you put in it, and can be minimized by tweaking a number of properties:</p>
<ol>
<li>Amount of objects watched (<code>watcher::Config</code>)</li>
<li>Asking for only metadata (<code>metadata_watcher</code>)</li>
<li>Pruning unnecessary fields before storing (<code>WatchStreamExt</code>)</li>
</ol>
<p>We have already talked about the first two points (<a href="#reducing-number-of-watched-objects">#Reducing Number of Watched Objects</a> and <a href="#watching-metadata-only">#Watching Metadata Only</a>) above as these have IO benefits for watchers on their own, but also cause memory usage reductions by forcing less stored objects/data.</p>
<h3 id="pruning-fields">Pruning Fields<a class="headerlink" href="#pruning-fields" title="Permanent link">#</a></h3>
<p>By default, the memory stored for each object is equivalent to what you get from asking <code>kubectl</code> for all objects matching your <code>ListParams</code>, but additionally asking for <code>--show-managed-fields</code> which <code>kubectl</code> hides from you by default, but is always part of any underlying api based request.</p>
<p>Most controllers do not need to know about the specifics of these, and they should usually be pruned pre-insertion:</p>
<div class="highlight"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">api</span><span class="p">:</span><span class="w"> </span><span class="nc">Api</span><span class="o">&lt;</span><span class="n">Pod</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Api</span><span class="p">::</span><span class="n">default_namespaced</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>
<span class="kd">let</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">watcher</span><span class="p">(</span><span class="n">pods</span><span class="p">,</span><span class="w"> </span><span class="n">watcher</span><span class="p">::</span><span class="n">Config</span><span class="p">::</span><span class="n">default</span><span class="p">()).</span><span class="n">modify</span><span class="p">(</span><span class="o">|</span><span class="n">pod</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// memory optimization for our store - we don&#39;t care about fields/annotations/status</span>
<span class="w">    </span><span class="n">pod</span><span class="p">.</span><span class="n">managed_fields_mut</span><span class="p">().</span><span class="n">clear</span><span class="p">();</span>
<span class="w">    </span><span class="n">pod</span><span class="p">.</span><span class="n">annotations_mut</span><span class="p">().</span><span class="n">clear</span><span class="p">();</span>
<span class="w">    </span><span class="n">pod</span><span class="p">.</span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">None</span><span class="p">;</span>
<span class="p">});</span>
<span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">reader</span><span class="p">,</span><span class="w"> </span><span class="n">writer</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reflector</span><span class="p">::</span><span class="n">store</span><span class="p">::</span><span class="o">&lt;</span><span class="n">Pod</span><span class="o">&gt;</span><span class="p">();</span>
<span class="kd">let</span><span class="w"> </span><span class="n">rf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reflector</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span><span class="w"> </span><span class="n">stream</span><span class="p">).</span><span class="n">applied_objects</span><span class="p">();</span>
</code></pre></div>
<p>In the above example we also clear out the status object and annotations entirely pre-storage.</p>
<p>This can be effective, even when already using <a href="https://docs.rs/kube/latest/kube/runtime/fn.metadata_watcher.html">metadata_watcher</a>, as managed-fields often accounts for close to half of the metadata yaml. Here is the result of clearing only managed fields from a roughly ~2000 object metadata reflector cache:</p>
<p><img alt="" src="../memory-pruning.png" /></p>
<p>For reference, here is the full graph showing the effect of first switching from <code>watcher</code> to <code>metadata_watcher</code> (which effectively acts as a smarter way to prune the Spec/Status) on a 2000 object <code>Pod</code> reflector that adds managed field pruning on top:</p>
<p><img alt="memory usage graphs over 3 hours showing differences between using a watcher, metadata_watcher and a metadata_watcher with managed-field pruning showing ~30% improvements between each one" src="../memory-opt.png" /></p>
<p>Except for some of the .metadata properties  <strong>pruning can generally be done for all the fields you do not care about</strong>.</p>
<div class="admonition warning">
<p class="admonition-title">Pruning ObjectMeta</p>
<p>Do <strong>not</strong> prune <strong>everything</strong> from <a href="https://docs.rs/kube/latest/kube/core/struct.ObjectMeta.html">ObjectMeta</a> as <code>kube::runtime</code> relies on being able to see <code>.metadata.name</code>, <code>.metadata.resourceVersion</code>, <code>.metadata.namespace</code> and in some cases <code>.metadata.ownerReferences</code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Pruning will not reduce your network traffic</p>
<p>All object data passed through a <code>watcher</code> is always ultimately received over the wire from <code>kube-apiserver</code>. Pruning is only local truncation.</p>
</div>
<h2 id="reconciler-optimization">Reconciler Optimization<a class="headerlink" href="#reconciler-optimization" title="Permanent link">#</a></h2>
<p>The <a href="../reconciler/">reconciler</a> is generally the entry-point for your business logic, so we cannot give too much blanket advice on optimizing this, but we can give a few pointers.</p>
<p>Note that instrumenting standard metrics (<a href="../observability/#what-metrics">observability#what-metrics</a>) on your reconciler, and sending traces of more complicated microservice interactions to a trace collector (<a href="../observability/#instrumenting">observability#instrumenting</a>) are good <a href="../observability/">observability</a> practices, and can go a long way in identifying performance issues.</p>
<h3 id="repeatedly-triggering-yourself">Repeatedly Triggering Yourself<a class="headerlink" href="#repeatedly-triggering-yourself" title="Permanent link">#</a></h3>
<p>AKA the problem that you will most easily run into; a <strong>reconciler that modifies the status</strong> (say) of its main <a href="../object/">object</a> will cause a change in that object that is picked up by the <a href="https://docs.rs/kube/latest/kube/runtime/struct.Controller.html">Controller</a>'s watcher loop, and will be <strong>fed back into the reconciler</strong>.</p>
<p>This is normally not a problem, because <strong>if</strong> your status patch that causes this change is <strong>idempotent</strong>, it will <strong>only happen once</strong>. The problem is when you start putting non-deterministic values inside the the <code>.status</code> resource (e.g. timestamps rather than hashes).</p>
<p>In such cases, the <strong>controller will spin forever</strong> on such objects.</p>
<div class="admonition note">
<p class="admonition-title">Detecting spinlocks</p>
<p>Spinlocks are usually noticeable quickly by just running the controller locally and watching logs for one object, or having a plot graph on your reconciler rate (<a href="../observability/#what-metrics">observability#what-metrics</a>) in <code>grafana</code>. You should expect about 1 to 5+ reconciles every <code>1/(your requeue time)</code> growing with the number of affected objects and self-interaction.</p>
</div>
<p>The two ways to avoid reconciler re-triggering are:</p>
<ol>
<li>don't patch in non-deterministic values to your object (breaks idempotency)</li>
<li>filter out changes to irrelevant parts of your object</li>
</ol>
<p>These approaches are <strong>both recommended</strong> because they both have independent merits;</p>
<ol>
<li>idempotency is good, and it avoids the spin problem the "good practice way"</li>
<li>early filtering can allow for more precise reconcile bypasses with less code complexity, and allow opt-in non-determinism (such as timestamp fields)</li>
</ol>
<p>Watch events can be filtered out early using <a href="https://docs.rs/kube/latest/kube/runtime/utils/predicates/index.html">predicates</a> with <a href="https://docs.rs/kube/latest/kube/runtime/trait.WatchStreamExt.html#method.predicate_filter">WatchStreamExt::predicate_filter</a>, and passing on these pre-filtered streams to controllers:</p>
<div class="highlight"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">deploys</span><span class="p">:</span><span class="w"> </span><span class="nc">Api</span><span class="o">&lt;</span><span class="n">Deployment</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Api</span><span class="p">::</span><span class="n">default_namespaced</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>
<span class="kd">let</span><span class="w"> </span><span class="n">changed_deploys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">watcher</span><span class="p">(</span><span class="n">deploys</span><span class="p">,</span><span class="w"> </span><span class="n">watcher</span><span class="p">::</span><span class="n">Config</span><span class="p">::</span><span class="n">default</span><span class="p">())</span>
<span class="w">    </span><span class="p">.</span><span class="n">applied_objects</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="n">predicate_filter</span><span class="p">(</span><span class="n">predicates</span><span class="p">::</span><span class="n">generation</span><span class="p">);</span>
</code></pre></div>
<h3 id="debouncing-repetitions">Debouncing Repetitions<a class="headerlink" href="#debouncing-repetitions" title="Permanent link">#</a></h3>
<p>After kube 0.86 (via <a href="https://github.com/kube-rs/kube/pull/1265">#1265</a>) it is possible to <a href="https://en.wiktionary.org/wiki/debounce">debounce</a> to filter out reconcile calls that happen quick succession (only taking the latest). A debounce time can be set on the <a href="https://docs.rs/kube/latest/kube/runtime/controller/struct.Config.html">controller::Config</a>, and will <strong>introduce a delay</strong> between the observed event and the eventual reconcile call, triggering <strong>only after</strong> no relevant events have been seen for the debounce period.</p>
<div class="highlight"><pre><span></span><code><span class="n">Controller</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">pods</span><span class="p">,</span><span class="w"> </span><span class="n">watcher</span><span class="p">::</span><span class="n">Config</span><span class="p">::</span><span class="n">default</span><span class="p">())</span>
<span class="w">    </span><span class="p">.</span><span class="n">with_config</span><span class="p">(</span><span class="n">controller</span><span class="p">::</span><span class="n">Config</span><span class="p">::</span><span class="n">default</span><span class="p">().</span><span class="n">debounce</span><span class="p">(</span><span class="n">Duration</span><span class="p">::</span><span class="n">from_secs</span><span class="p">(</span><span class="mi">5</span><span class="p">)))</span>
</code></pre></div>
<p>A common example is to lessen the noise from rapid <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/#pod-phase">phase</a> transitions of <code>Pod</code> watches (which receives several repeat status updates after initial application). If your controller only treats pods as a watched resource and does not need to react to every status update, then introducing a handful of seconds of debounce time can help reduce reconciler load:</p>
<p><img alt="" src="../debounce-workloads.png" /></p>
<p>The graph shows how a <code>5s</code> debounce acts on reconciliation rates for various workloads (via 4 different controllers) in a cluster with ~1500 pods (the last dashed line indicates a deployment of the controller that enabled debounce).</p>
<div class="admonition warning">
<p class="admonition-title">Debounce effect is situational and will slow down responsiveness</p>
<p>As can be seen from the generally completely unaffected other kinds in the above graph, the effect may not benefit all controllers, and a downside is that it will slow down the controller's average response time to changes. A few seconds can be helpful while waiting for other eventually-consistent components, but beyond that you should consider the tradeoff between the <strong>consistency loss</strong> and the <strong>cost of re-running</strong>.</p>
</div>
<p>See the documentation for <a href="https://docs.rs/kube/latest/kube/runtime/controller/struct.Config.html">controller::Config</a> for more information.</p>
<h3 id="reconciler-concurrency">Reconciler Concurrency<a class="headerlink" href="#reconciler-concurrency" title="Permanent link">#</a></h3>
<p>The controller will schedule <strong>different objects</strong> concurrently. For example, for the event queue ABA, we'd currently schedule object A and B to reconcile concurrently, and start the second reconciliation of A as soon as the first one finishes. Our guarantee here is that <strong>kube will never run two reconciliations for the same object concurrently</strong>. This means that default kube behaviour is <strong>infinite concurrency</strong> whereas <code>controller-runtime</code> has <a href="https://github.com/kubernetes-sigs/controller-runtime/blob/aa9f8c9e8ef099910ff36031ccafe900fe31d9e1/pkg/controller/controller.go#L39-L40">no default concurrency</a>.</p>
<p>On large datasets, spiky workloads can occur with this default. Big datasets being funnelled through the <code>watcher</code> and into the reconciler can cause large amount of work, and when using consistent requeue times, that same spike is likely to show up later:</p>
<p><img alt="" src="../spiky-workload.png" /></p>
<p>To flatten such a workload curve, consider limiting your <code>concurrency</code> to control how much work can happen at the same time.</p>
<div class="highlight"><pre><span></span><code><span class="n">Controller</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">pods</span><span class="p">,</span><span class="w"> </span><span class="n">watcher</span><span class="p">::</span><span class="n">Config</span><span class="p">::</span><span class="n">default</span><span class="p">())</span>
<span class="w">    </span><span class="p">.</span><span class="n">with_config</span><span class="p">(</span><span class="n">controller</span><span class="p">::</span><span class="n">Config</span><span class="p">::</span><span class="n">default</span><span class="p">().</span><span class="n">concurency</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Reconciler Deduplication</p>
<p>Multiple repeat reconciliations for the same object are <strong>deduplicated</strong> if they are queued but haven't been started yet. For example, a queue for two objects that is meant to run <code>ABABAAAAA</code> will be deduped into a shorter queue <code>ABAB</code>, assuming that <code>A1</code> and <code>B1</code> are still executing when the subsequent entries come in.</p>
</div>
<h2 id="future-optimizations">Future Optimizations<a class="headerlink" href="#future-optimizations" title="Permanent link">#</a></h2>
<p>Not everything is possible to optimize yet. Some tracking issues:</p>
<ul>
<li><a href="https://github.com/kube-rs/kube/issues/1080">Sharing watcher streams and caches between Controllers</a></li>
</ul>
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">#</a></h2>
<p>As a short summary, here are the main listed optimization and the effect you should expect to see from utilising them.</p>
<table>
<thead>
<tr>
<th>Optimization Type</th>
<th>Target Reduction</th>
</tr>
</thead>
<tbody>
<tr>
<td>metadata_watcher</td>
<td>IO + Memory</td>
</tr>
<tr>
<td>watcher selectors</td>
<td>IO + Memory</td>
</tr>
<tr>
<td>watcher streaming list &gt;=1.33</td>
<td>Memory</td>
</tr>
<tr>
<td>watcher page size &lt;1.33</td>
<td>Memory</td>
</tr>
<tr>
<td>reconciler concurrency</td>
<td>Spikes</td>
</tr>
<tr>
<td>pruning</td>
<td>Memory</td>
</tr>
<tr>
<td>predicates</td>
<td>IO + CPU</td>
</tr>
</tbody>
</table>
<p>It is important to note that <strong>most of these are watcher tweaks</strong>.<br />
The target reductions above can all be granted by passing more precise streams to your controller, or by tweaking controller input parameters.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://docs.rs/kube" target="_blank" rel="noopener" title="docs.rs" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="m508.52 249.75-21.82-13.51c-.17-2-.34-3.93-.55-5.88l18.72-17.5a7.35 7.35 0 0 0-2.44-12.25l-24-9c-.54-1.88-1.08-3.78-1.67-5.64l15-20.83a7.35 7.35 0 0 0-4.79-11.54l-25.42-4.15c-.9-1.73-1.79-3.45-2.73-5.15l10.68-23.42a7.35 7.35 0 0 0-6.95-10.39l-25.82.91q-1.79-2.22-3.61-4.4L439 81.84a7.36 7.36 0 0 0-8.84-8.84L405 78.93q-2.17-1.83-4.4-3.61l.91-25.82a7.35 7.35 0 0 0-10.39-7L367.7 53.23c-1.7-.94-3.43-1.84-5.15-2.73l-4.15-25.42a7.35 7.35 0 0 0-11.54-4.79L326 35.26c-1.86-.59-3.75-1.13-5.64-1.67l-9-24a7.35 7.35 0 0 0-12.25-2.44l-17.5 18.72c-1.95-.21-3.91-.38-5.88-.55L262.25 3.48a7.35 7.35 0 0 0-12.5 0L236.24 25.3c-2 .17-3.93.34-5.88.55l-17.5-18.72a7.35 7.35 0 0 0-12.25 2.44l-9 24c-1.89.55-3.79 1.08-5.66 1.68l-20.82-15a7.35 7.35 0 0 0-11.54 4.79l-4.15 25.41c-1.73.9-3.45 1.79-5.16 2.73l-23.4-10.63a7.35 7.35 0 0 0-10.39 7l.92 25.81c-1.49 1.19-3 2.39-4.42 3.61L81.84 73A7.36 7.36 0 0 0 73 81.84L78.93 107c-1.23 1.45-2.43 2.93-3.62 4.41l-25.81-.91a7.42 7.42 0 0 0-6.37 3.26 7.35 7.35 0 0 0-.57 7.13l10.66 23.41c-.94 1.7-1.83 3.43-2.73 5.16l-25.41 4.14a7.35 7.35 0 0 0-4.79 11.54l15 20.82c-.59 1.87-1.13 3.77-1.68 5.66l-24 9a7.35 7.35 0 0 0-2.44 12.25l18.72 17.5c-.21 1.95-.38 3.91-.55 5.88l-21.86 13.5a7.35 7.35 0 0 0 0 12.5l21.82 13.51c.17 2 .34 3.92.55 5.87l-18.72 17.5a7.35 7.35 0 0 0 2.44 12.25l24 9c.55 1.89 1.08 3.78 1.68 5.65l-15 20.83a7.35 7.35 0 0 0 4.79 11.54l25.42 4.15c.9 1.72 1.79 3.45 2.73 5.14l-10.63 23.43a7.35 7.35 0 0 0 .57 7.13 7.13 7.13 0 0 0 6.37 3.26l25.83-.91q1.77 2.22 3.6 4.4L73 430.16a7.36 7.36 0 0 0 8.84 8.84l25.16-5.93q2.18 1.83 4.41 3.61l-.92 25.82a7.35 7.35 0 0 0 10.39 6.95l23.43-10.68c1.69.94 3.42 1.83 5.14 2.73l4.15 25.42a7.34 7.34 0 0 0 11.54 4.78l20.83-15c1.86.6 3.76 1.13 5.65 1.68l9 24a7.36 7.36 0 0 0 12.25 2.44l17.5-18.72c1.95.21 3.92.38 5.88.55l13.51 21.82a7.35 7.35 0 0 0 12.5 0l13.51-21.82c2-.17 3.93-.34 5.88-.56l17.5 18.73a7.36 7.36 0 0 0 12.25-2.44l9-24c1.89-.55 3.78-1.08 5.65-1.68l20.82 15a7.34 7.34 0 0 0 11.54-4.78l4.15-25.42c1.72-.9 3.45-1.79 5.15-2.73l23.42 10.68a7.35 7.35 0 0 0 10.39-6.95l-.91-25.82q2.22-1.79 4.4-3.61l25.15 5.93a7.36 7.36 0 0 0 8.84-8.84L433.07 405q1.83-2.17 3.61-4.4l25.82.91a7.23 7.23 0 0 0 6.37-3.26 7.35 7.35 0 0 0 .58-7.13l-10.68-23.42c.94-1.7 1.83-3.43 2.73-5.15l25.42-4.15a7.35 7.35 0 0 0 4.79-11.54l-15-20.83c.59-1.87 1.13-3.76 1.67-5.65l24-9a7.35 7.35 0 0 0 2.44-12.25l-18.72-17.5c.21-1.95.38-3.91.55-5.87l21.82-13.51a7.35 7.35 0 0 0 0-12.5Zm-151 129.08A13.91 13.91 0 0 0 341 389.51l-7.64 35.67a187.51 187.51 0 0 1-156.36-.74l-7.64-35.66a13.87 13.87 0 0 0-16.46-10.68l-31.51 6.76a187.38 187.38 0 0 1-16.26-19.21H258.3c1.72 0 2.89-.29 2.89-1.91v-54.19c0-1.57-1.17-1.91-2.89-1.91h-44.83l.05-34.35H262c4.41 0 23.66 1.28 29.79 25.87 1.91 7.55 6.17 32.14 9.06 40 2.89 8.82 14.6 26.46 27.1 26.46H407a187.3 187.3 0 0 1-17.34 20.09Zm25.77 34.49A15.24 15.24 0 1 1 368 398.08h.44a15.23 15.23 0 0 1 14.8 15.24Zm-225.62-.68a15.24 15.24 0 1 1-15.25-15.25h.45a15.25 15.25 0 0 1 14.75 15.25Zm-88.1-178.49 32.83-14.6a13.88 13.88 0 0 0 7.06-18.33L102.69 186h26.56v119.73h-53.6a187.65 187.65 0 0 1-6.08-71.58Zm-11.26-36.06a15.24 15.24 0 0 1 15.23-15.25H74a15.24 15.24 0 1 1-15.67 15.24Zm155.16 24.49.05-35.32h63.26c3.28 0 23.07 3.77 23.07 18.62 0 12.29-15.19 16.7-27.68 16.7ZM399 306.71c-9.8 1.13-20.63-4.12-22-10.09-5.78-32.49-15.39-39.4-30.57-51.4 18.86-11.95 38.46-29.64 38.46-53.26 0-25.52-17.49-41.59-29.4-49.48-16.76-11-35.28-13.23-40.27-13.23h-198.9a187.49 187.49 0 0 1 104.89-59.19l23.47 24.6a13.82 13.82 0 0 0 19.6.44l26.26-25a187.51 187.51 0 0 1 128.37 91.43l-18 40.57a14 14 0 0 0 7.09 18.33l34.59 15.33a187.12 187.12 0 0 1 .4 32.54h-19.28c-1.91 0-2.69 1.27-2.69 3.13v8.82C421 301 409.31 305.58 399 306.71ZM240 60.21A15.24 15.24 0 0 1 255.21 45h.45A15.24 15.24 0 1 1 240 60.21ZM436.84 214a15.24 15.24 0 1 1 0-30.48h.44a15.24 15.24 0 0 1-.44 30.48Z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/kube-rs/kube/discussions" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://discord.gg/tokio" target="_blank" rel="noopener" title="discord.gg" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485.065 485.065 0 0 0 404.081 32.03a1.816 1.816 0 0 0-1.923.91 337.461 337.461 0 0 0-14.9 30.6 447.848 447.848 0 0 0-134.426 0 309.541 309.541 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.689 483.689 0 0 0-119.688 37.107 1.712 1.712 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.016 2.016 0 0 0 .765 1.375 487.666 487.666 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348.2 348.2 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321.173 321.173 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251.047 251.047 0 0 0 9.109-7.137 1.819 1.819 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.812 1.812 0 0 1 1.924.233 234.533 234.533 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.407 301.407 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391.055 391.055 0 0 0 30.014 48.815 1.864 1.864 0 0 0 2.063.7A486.048 486.048 0 0 0 610.7 405.729a1.882 1.882 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541ZM222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241Zm195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241Z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linuxfoundation.org/legal/trademark-usage" target="_blank" rel="noopener" title="www.linuxfoundation.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M220.8 123.3c1 .5 1.8 1.7 3 1.7 1.1 0 2.8-.4 2.9-1.5.2-1.4-1.9-2.3-3.2-2.9-1.7-.7-3.9-1-5.5-.1-.4.2-.8.7-.6 1.1.3 1.3 2.3 1.1 3.4 1.7zm-21.9 1.7c1.2 0 2-1.2 3-1.7 1.1-.6 3.1-.4 3.5-1.6.2-.4-.2-.9-.6-1.1-1.6-.9-3.8-.6-5.5.1-1.3.6-3.4 1.5-3.2 2.9.1 1 1.8 1.5 2.8 1.4zM420 403.8c-3.6-4-5.3-11.6-7.2-19.7-1.8-8.1-3.9-16.8-10.5-22.4-1.3-1.1-2.6-2.1-4-2.9-1.3-.8-2.7-1.5-4.1-2 9.2-27.3 5.6-54.5-3.7-79.1-11.4-30.1-31.3-56.4-46.5-74.4-17.1-21.5-33.7-41.9-33.4-72C311.1 85.4 315.7.1 234.8 0 132.4-.2 158 103.4 156.9 135.2c-1.7 23.4-6.4 41.8-22.5 64.7-18.9 22.5-45.5 58.8-58.1 96.7-6 17.9-8.8 36.1-6.2 53.3-6.5 5.8-11.4 14.7-16.6 20.2-4.2 4.3-10.3 5.9-17 8.3s-14 6-18.5 14.5c-2.1 3.9-2.8 8.1-2.8 12.4 0 3.9.6 7.9 1.2 11.8 1.2 8.1 2.5 15.7.8 20.8-5.2 14.4-5.9 24.4-2.2 31.7 3.8 7.3 11.4 10.5 20.1 12.3 17.3 3.6 40.8 2.7 59.3 12.5 19.8 10.4 39.9 14.1 55.9 10.4 11.6-2.6 21.1-9.6 25.9-20.2 12.5-.1 26.3-5.4 48.3-6.6 14.9-1.2 33.6 5.3 55.1 4.1.6 2.3 1.4 4.6 2.5 6.7v.1c8.3 16.7 23.8 24.3 40.3 23 16.6-1.3 34.1-11 48.3-27.9 13.6-16.4 36-23.2 50.9-32.2 7.4-4.5 13.4-10.1 13.9-18.3.4-8.2-4.4-17.3-15.5-29.7zM223.7 87.3c9.8-22.2 34.2-21.8 44-.4 6.5 14.2 3.6 30.9-4.3 40.4-1.6-.8-5.9-2.6-12.6-4.9 1.1-1.2 3.1-2.7 3.9-4.6 4.8-11.8-.2-27-9.1-27.3-7.3-.5-13.9 10.8-11.8 23-4.1-2-9.4-3.5-13-4.4-1-6.9-.3-14.6 2.9-21.8zM183 75.8c10.1 0 20.8 14.2 19.1 33.5-3.5 1-7.1 2.5-10.2 4.6 1.2-8.9-3.3-20.1-9.6-19.6-8.4.7-9.8 21.2-1.8 28.1 1 .8 1.9-.2-5.9 5.5-15.6-14.6-10.5-52.1 8.4-52.1zm-13.6 60.7c6.2-4.6 13.6-10 14.1-10.5 4.7-4.4 13.5-14.2 27.9-14.2 7.1 0 15.6 2.3 25.9 8.9 6.3 4.1 11.3 4.4 22.6 9.3 8.4 3.5 13.7 9.7 10.5 18.2-2.6 7.1-11 14.4-22.7 18.1-11.1 3.6-19.8 16-38.2 14.9-3.9-.2-7-1-9.6-2.1-8-3.5-12.2-10.4-20-15-8.6-4.8-13.2-10.4-14.7-15.3-1.4-4.9 0-9 4.2-12.3zm3.3 334c-2.7 35.1-43.9 34.4-75.3 18-29.9-15.8-68.6-6.5-76.5-21.9-2.4-4.7-2.4-12.7 2.6-26.4v-.2c2.4-7.6.6-16-.6-23.9-1.2-7.8-1.8-15 .9-20 3.5-6.7 8.5-9.1 14.8-11.3 10.3-3.7 11.8-3.4 19.6-9.9 5.5-5.7 9.5-12.9 14.3-18 5.1-5.5 10-8.1 17.7-6.9 8.1 1.2 15.1 6.8 21.9 16l19.6 35.6c9.5 19.9 43.1 48.4 41 68.9zm-1.4-25.9c-4.1-6.6-9.6-13.6-14.4-19.6 7.1 0 14.2-2.2 16.7-8.9 2.3-6.2 0-14.9-7.4-24.9-13.5-18.2-38.3-32.5-38.3-32.5-13.5-8.4-21.1-18.7-24.6-29.9s-3-23.3-.3-35.2c5.2-22.9 18.6-45.2 27.2-59.2 2.3-1.7.8 3.2-8.7 20.8-8.5 16.1-24.4 53.3-2.6 82.4.6-20.7 5.5-41.8 13.8-61.5 12-27.4 37.3-74.9 39.3-112.7 1.1.8 4.6 3.2 6.2 4.1 4.6 2.7 8.1 6.7 12.6 10.3 12.4 10 28.5 9.2 42.4 1.2 6.2-3.5 11.2-7.5 15.9-9 9.9-3.1 17.8-8.6 22.3-15 7.7 30.4 25.7 74.3 37.2 95.7 6.1 11.4 18.3 35.5 23.6 64.6 3.3-.1 7 .4 10.9 1.4 13.8-35.7-11.7-74.2-23.3-84.9-4.7-4.6-4.9-6.6-2.6-6.5 12.6 11.2 29.2 33.7 35.2 59 2.8 11.6 3.3 23.7.4 35.7 16.4 6.8 35.9 17.9 30.7 34.8-2.2-.1-3.2 0-4.2 0 3.2-10.1-3.9-17.6-22.8-26.1-19.6-8.6-36-8.6-38.3 12.5-12.1 4.2-18.3 14.7-21.4 27.3-2.8 11.2-3.6 24.7-4.4 39.9-.5 7.7-3.6 18-6.8 29-32.1 22.9-76.7 32.9-114.3 7.2zm257.4-11.5c-.9 16.8-41.2 19.9-63.2 46.5-13.2 15.7-29.4 24.4-43.6 25.5s-26.5-4.8-33.7-19.3c-4.7-11.1-2.4-23.1 1.1-36.3 3.7-14.2 9.2-28.8 9.9-40.6.8-15.2 1.7-28.5 4.2-38.7 2.6-10.3 6.6-17.2 13.7-21.1.3-.2.7-.3 1-.5.8 13.2 7.3 26.6 18.8 29.5 12.6 3.3 30.7-7.5 38.4-16.3 9-.3 15.7-.9 22.6 5.1 9.9 8.5 7.1 30.3 17.1 41.6 10.6 11.6 14 19.5 13.7 24.6zM173.3 148.7c2 1.9 4.7 4.5 8 7.1 6.6 5.2 15.8 10.6 27.3 10.6 11.6 0 22.5-5.9 31.8-10.8 4.9-2.6 10.9-7 14.8-10.4s5.9-6.3 3.1-6.6-2.6 2.6-6 5.1c-4.4 3.2-9.7 7.4-13.9 9.8-7.4 4.2-19.5 10.2-29.9 10.2s-18.7-4.8-24.9-9.7c-3.1-2.5-5.7-5-7.7-6.9-1.5-1.4-1.9-4.6-4.3-4.9-1.4-.1-1.8 3.7 1.7 6.5z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.instant", "navigation.tracking", "navigation.prune", "content.action.edit"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  </body>
</html>